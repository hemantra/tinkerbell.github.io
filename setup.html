
<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <title>Tinkerbell, a Provisioning Engine by Packet</title>
    <meta name="generator" content="Packet Host, Inc." />
    <meta property="og:title" content="Tinkerbell" />
    <meta property="og:locale" content="en_US" />
    <meta name="description" content="Tinkerbell, a Provisioning Engine by Packet" />
    <meta property="og:description" content="Tinkerbell, a Provisioning Engine by Packet" />
    <link rel="canonical" href="https://tinkerbell.org/" />
    <meta property="og:url" content="https://tinkerbell.org/" />
    <meta property="og:site_name" content="tinkerbell.org" />
    <link rel="icon" type="image/png" sizes="128x128" href="favicon.png?v=1">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700&display=swap" rel="stylesheet">

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="style.css?v=11">
  </head>
  <body>
	<div class="logo-header">
		<div class="logo-header-dots">
			<div class="logo">
          <a href="/"><img src="logo-white.png" height=54 /></a>
			</div>
			<div class="menu">
				<ul>
					<li><a href="/">Home</a></li>
					<li><a href="/setup">Setup</a></li>
				</ul>
			</div>
		</div>
	</div>

<section class="main-content setup">
<h2 id="setup-a-provisioner">Running a Sample Workflow</h2>

<h3 id="create-the-servers">Create the servers</h3>
<ul>
  <li>Clone the rover code with <code class="language-plaintext highlighter-rouge">setup_provisioner_and_worker</code> branch</li>
  <li>Run <code class="language-plaintext highlighter-rouge">make</code></li>
  <li>Change into the <code class="language-plaintext highlighter-rouge">rover/terraform</code> directory</li>
  <li>Modify the <code class="language-plaintext highlighter-rouge">input.tf</code> file with your Packet API key and Github login credentials</li>
  <li>Run <code class="language-plaintext highlighter-rouge">terraform init</code> and <code class="language-plaintext highlighter-rouge">terraform apply</code>
    <ul>
      <li>Creates a complete setup with <em>tf-provisioner</em> and <em>tf-worker</em> machines on which you can run any workflow</li>
      <li>The IP address of provisioner and MAC address of worker machine are recorded in the <code class="language-plaintext highlighter-rouge">outputs</code> field of <code class="language-plaintext highlighter-rouge">terraform.tfstate</code></li>
    </ul>
  </li>
</ul>
<h3 id="create-sample-workflow">Create and run a workflow</h3>
<ul>
  <li>SSH into the <em>tf-provisioner</em> machine</li>
  <li>Switch to the <code class="language-plaintext highlighter-rouge">first-good-workflow</code> branch
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd ~/go/src/github.com/packethost/tinkerbell/
git checkout first-good-workflow</code></pre></div></div>
  </li>
  <li>Replace only the MAC addresses in the <code class="language-plaintext highlighter-rouge">push.sh</code> file with the MAC address of the <em>tf-worker</em> machine which is retrievable from the terraform output.</li>
  <li>Push the hardware data with <code class="language-plaintext highlighter-rouge">./push.sh</code></li>
  <li>Create action images and push them in to the private registry:
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd ~/go/src/github.com/packethost/rover/workflow-samples/ubuntu/v3/
./create_image.sh</code></pre></div></div>
  </li>
  <li>Create the workflow
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rover target create '{"targets": {"machine1": {"mac_addr": "&lt;mac address of tf-worker&gt;"}}}'
rover template create -n ubuntu-sample -p /root/go/src/github.com/packethost/rover/workflow-samples/ubuntu/v3/ubuntu.tmpl
rover workflow create -t &lt;template_id&gt; -r &lt;target_id&gt;</code></pre></div></div>
  </li>
  <li>Reboot the <em>tf-worker</em> machine</li>
</ul>
<hr/>
<h3 id="troubleshooting">Troubleshooting</h3>
<ul>
  <li>Terraform unable to SSH into machine
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Error: timeout - last error: SSH authentication failed (root@&lt;provisioner_ip&gt;:22): ssh: handshake failed: ssh: unable to authenticate, attempted methods [none publickey], no supported methods remain</code></pre></div></div>
    <p>Add private key to SSH authentication agent with <code class="language-plaintext highlighter-rouge">ssh-add &lt;path_to_private_key&gt;</code></p>
  </li>
</ul>

</section>

  </body>
</html>

